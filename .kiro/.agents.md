# Yeko Project Agent Guidelines

This document provides guidance for Claude agents and AI assistants working on the Yeko project.

## Project Context

**Yeko** is an EdTech SaaS platform for school management in French-speaking Africa. The architecture follows a **Core → School → [Teacher/Parent]** pattern:

- **Yeko Core**: Super Admin platform providing global templates and catalogs
- **Yeko School**: Multi-tenant school administration (instantiates Core templates)
- **Yeko Teacher/Parent**: Consumer apps (future phases)

## Tech Stack Summary

| Layer | Technology |
|-------|-----------|
| Frontend | TanStack Start (React 19 + SSR), Tailwind CSS v4, shadcn/ui |
| State | TanStack Query v5, React Hook Form |
| Backend | Cloudflare Workers, Better Auth |
| Database | PostgreSQL (Neon serverless), Drizzle ORM |
| Validation | Zod v4 |
| i18n | i18next (French default, English support) |
| Testing | Vitest, @testing-library/react |
| Monorepo | pnpm workspaces |

## Key Development Principles

### 1. Type Safety First
- Use TypeScript strict mode
- Leverage Zod for runtime validation
- Infer types from schemas and database
- Avoid `any` types

### 2. Security by Default
- No hardcoded secrets or credentials
- Always validate input with Zod schemas
- Use Drizzle ORM to prevent SQL injection
- Check authentication on protected routes/functions

### 3. Performance Matters
- Configure React Query caching (staleTime, gcTime)
- Avoid unnecessary re-renders
- Use pagination for large lists
- Optimize database queries with indexes

### 4. Internationalization Required
- All UI strings must use i18next (`t()` function)
- Default language is French (fr)
- Support English (en) as secondary language
- Use translation keys like `feature.action`

### 5. Code Quality Standards
- Run `pnpm run typecheck` before submitting
- Run `pnpm run lint:fix` to fix linting issues
- Run `pnpm run test` to verify tests pass
- Use logger package instead of console.log
- Follow file naming conventions (kebab-case components, use-prefix hooks)

## Common Development Tasks

### Creating a New Component

```typescript
// components/schools/school-card.tsx
import { useTranslation } from 'react-i18next'
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card'
import { Button } from '@/components/ui/button'

interface SchoolCardProps {
  school: School
  onEdit?: (id: string) => void
}

export function SchoolCard({ school, onEdit }: SchoolCardProps) {
  const { t } = useTranslation()
  
  return (
    <Card>
      <CardHeader>
        <CardTitle>{school.name}</CardTitle>
      </CardHeader>
      <CardContent>
        <p className="text-sm text-muted-foreground">{school.code}</p>
        {onEdit && (
          <Button onClick={() => onEdit(school.id)} className="mt-4">
            {t('common.edit')}
          </Button>
        )}
      </CardContent>
    </Card>
  )
}
```

### Creating a Server Function

```typescript
// core/functions/schools.ts
import { createServerFn } from '@tanstack/react-start'
import { z } from 'zod'
import { getSchools as querySchools } from '@repo/data-ops/queries/schools'

export const getSchools = createServerFn({ method: 'GET' })
  .validator(
    z.object({
      status: z.enum(['active', 'inactive', 'suspended']).optional(),
      page: z.number().optional().default(1),
    })
  )
  .handler(async ({ data }) => {
    return await querySchools(data)
  })
```

### Creating a Database Query

```typescript
// packages/data-ops/src/queries/schools.ts
import { db } from '../database/client'
import { schools } from '../drizzle/core-schema'
import { eq, and } from 'drizzle-orm'

export async function getSchools(params?: {
  status?: string
  page?: number
  pageSize?: number
}) {
  const { status, page = 1, pageSize = 10 } = params ?? {}
  
  const conditions = []
  if (status) conditions.push(eq(schools.status, status))
  
  const [data, countResult] = await Promise.all([
    db.select()
      .from(schools)
      .where(conditions.length ? and(...conditions) : undefined)
      .limit(pageSize)
      .offset((page - 1) * pageSize),
    db.select({ count: sql<number>`count(*)` })
      .from(schools)
      .where(conditions.length ? and(...conditions) : undefined),
  ])
  
  return {
    data,
    total: countResult[0]?.count ?? 0,
    page,
    pageSize,
  }
}
```

### Using React Query in Components

```typescript
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'
import { schoolsQueryOptions } from '@/integrations/tanstack-query/schools-options'
import { createSchool } from '@/core/functions/schools'

function SchoolsPage() {
  const queryClient = useQueryClient()
  const { data, isLoading, error } = useQuery(schoolsQueryOptions())
  
  const mutation = useMutation({
    mutationFn: createSchool,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['schools'] })
      toast.success(t('schools.created'))
    },
  })
  
  if (isLoading) return <Skeleton />
  if (error) return <ErrorMessage error={error} />
  
  return (
    <div>
      {data?.map(school => (
        <SchoolCard key={school.id} school={school} />
      ))}
    </div>
  )
}
```

## File Organization

```
apps/core/src/
  routes/                    # TanStack Router file-based routes
    __root.tsx              # Root layout
    index.tsx               # Landing page
    _auth/                  # Protected routes layout
      app/
        index.tsx           # Dashboard
        schools.tsx         # Schools list
        schools.$schoolId.tsx # School detail
  core/
    functions/              # Server functions
      schools.ts
      programs.ts
    middleware/             # Request middleware
  components/
    ui/                     # shadcn/ui primitives
    layout/                 # Layout components
    schools/                # Feature components
  integrations/
    tanstack-query/         # Query options factories
  schemas/                  # Zod validation schemas
  i18n/
    locales/
      fr.ts                 # French translations
      en.ts                 # English translations

packages/data-ops/src/
  drizzle/
    auth-schema.ts          # Auth tables
    core-schema.ts          # Core tables
  queries/                  # Database query functions
    schools.ts
    programs.ts
  database/
    client.ts               # Database connection
```

## Testing Guidelines

### Unit Tests
```typescript
import { describe, it, expect } from 'vitest'
import { schoolSchema } from './school'

describe('schoolSchema', () => {
  it('should validate valid school data', () => {
    const result = schoolSchema.safeParse({
      name: 'École Test',
      code: 'ET001',
      status: 'active',
    })
    expect(result.success).toBe(true)
  })
})
```

### Component Tests
```typescript
import { render, screen } from '@testing-library/react'
import userEvent from '@testing-library/user-event'
import { SchoolCard } from './school-card'

describe('SchoolCard', () => {
  it('should render school name', () => {
    render(<SchoolCard school={{ id: '1', name: 'Test', code: 'T1' }} />)
    expect(screen.getByText('Test')).toBeInTheDocument()
  })
})
```

## Common Commands

```bash
# Development
pnpm run dev:yeko-core      # Start Core app
pnpm run dev:yeko-school    # Start School app

# Code Quality
pnpm run typecheck          # Check TypeScript
pnpm run lint               # Run ESLint
pnpm run lint:fix           # Fix linting issues
pnpm run test               # Run tests
pnpm run test:watch         # Watch mode

# Database
cd packages/data-ops
pnpm run drizzle:generate   # Generate migrations
pnpm run drizzle:migrate    # Apply migrations
pnpm run studio             # Open Drizzle Studio
```

## Agent Responsibilities

### When Working on Features
1. Check the relevant steering file for patterns
2. Follow file naming conventions
3. Add i18n translations for all UI strings
4. Write tests for new functionality
5. Ensure TypeScript strict mode compliance
6. Use React Query for server state
7. Validate input with Zod schemas

### When Reviewing Code
1. Verify code compiles and lints
2. Check tests pass and coverage is adequate
3. Ensure i18n strings are used
4. Verify security best practices
5. Check performance considerations
6. Validate accessibility attributes

### When Debugging Issues
1. Check the error message and stack trace
2. Review relevant steering file for patterns
3. Look at similar working implementations
4. Use logger package for debugging
5. Check database schema and queries
6. Verify authentication/authorization

## Steering Files Reference

| File | Trigger | Use When |
|------|---------|----------|
| project-overview.md | Always | Understanding project structure |
| code-quality.md | Always | Code review and standards |
| typescript-standards.md | *.ts, *.tsx | Writing TypeScript code |
| react-components.md | *.tsx | Building React components |
| database-patterns.md | data-ops/**/*.ts | Writing database queries |
| api-patterns.md | functions/**/*.ts | Creating server functions |
| testing-standards.md | *.test.ts, *.test.tsx | Writing tests |
| i18n-guide.md | i18n/**/* | Adding translations |
| ui-design.md | components/**/*.tsx | Building UI |
| routing-navigation.md | routes/**/*.tsx | Creating routes |
| excel-import-export.md | Manual (#excel-import-export) | Excel features |

## Important Notes

- **French First**: Default language is French. Always add French translations first.
- **Type Safety**: Leverage TypeScript's type system. Avoid `any` types.
- **Database**: Use Drizzle ORM exclusively. Never write raw SQL.
- **Authentication**: Always check auth on protected routes/functions.
- **Performance**: Configure React Query caching for all queries.
- **Accessibility**: Include aria-labels and semantic HTML.
- **Logging**: Use logger package, never console.log in production code.

## Resources

- [Kiro Steering Documentation](https://kiro.dev/docs/steering)
- [TanStack Start Docs](https://tanstack.com/start/latest)
- [Drizzle ORM Docs](https://orm.drizzle.team)
- [React Query Docs](https://tanstack.com/query/latest)
- [shadcn/ui Components](https://ui.shadcn.com)
- [i18next Documentation](https://www.i18next.com)
